\documentclass[12pt,a4paper,twoside]{report}

% ===== PACKAGES =====
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
% Babel: 'francais' deprecated, switch to 'french'
\usepackage[french]{babel}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{listings}
\usepackage{csquotes} % Recommended with biblatex & babel
% If using XeLaTeX/LuaLaTeX, inputenc is ignored; consider removing \usepackage{inputenc}
\usepackage[table]{xcolor}
\usepackage{url}
% tocloft should be loaded before hyperref for proper link handling
% (we move hyperref to the end of package list below)
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{array}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{setspace}
\usepackage{titlesec}
\usepackage{tocloft}
\usepackage{appendix}
\usepackage[style=numeric,backend=bibtex]{biblatex}
% Load hyperref last
\usepackage{hyperref}
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}} % check mark
\newcommand{\warning}{\ding{115}} % warning symbol alternative

% ===== CONFIGURATION DE PAGE =====
\geometry{
    left=3cm,
    right=2.5cm,
    top=2.5cm,
    bottom=2.5cm,
    headheight=15pt
}

% ===== STYLE DES EN-TÊTES ET PIEDS DE PAGE =====
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE]{\leftmark}
\fancyhead[RO]{\rightmark}
\fancyfoot[LE,RO]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

% ===== CONFIGURATION DES TITRES =====
	\titleformat{\chapter}[hang]
{\normalfont\LARGE\bfseries}{\thechapter}{1em}{}
	\titlespacing*{\chapter}{0pt}{-30pt}{20pt}
% Harmoniser et réduire l'espace vertical surtout avant les subsubsections
	\titleformat{\section}[hang]{\normalfont\Large\bfseries}{\thesection}{1em}{}
	\titlespacing*{\section}{0pt}{2.5ex plus 1ex minus .2ex}{1.5ex plus .2ex}
	\titleformat{\subsection}[hang]{\normalfont\large\bfseries}{\thesubsection}{1em}{}
	\titlespacing*{\subsection}{0pt}{2.25ex plus 1ex minus .2ex}{1ex plus .2ex}
	\titleformat{\subsubsection}[hang]{\normalfont\normalsize\bfseries}{\thesubsubsection}{1em}{}
% Avant (before skip) réduit pour éviter grand espace constaté, après (after skip) compact
	\titlespacing*{\subsubsection}{0pt}{1.2ex plus .5ex minus .2ex}{0.7ex plus .2ex}

% ===== ESPACEMENT =====
\onehalfspacing
\setlength{\parindent}{1.5em}
\setlength{\parskip}{0.5em}

% ===== CONFIGURATION DES LISTINGS AVANCÉE =====
% Custom language definitions (simplified) for JSON, JavaScript, YAML
\lstdefinelanguage{json}{
    basicstyle=\ttfamily\small,
    comment=[l]{//},
    morestring=[b]",% strings
    stringstyle=\color{orange!70!black},
    showstringspaces=false
}
\lstdefinelanguage{JavaScript}{
    keywords={function,var,let,const,if,for,while,return,else,try,catch,new,JSON,parse,stringify,setInterval},
    sensitive=true,
    comment=[l]{//},
    morecomment=[s]{/*}{*/},
    morestring=[b]",
    morestring=[b]',
}
% YAML language definition (safe version)
\lstdefinelanguage{yaml}{
    comment=[l]{\#},
    morestring=[b]",
    morestring=[b]',
    keywords={true,false,null,yes,no},
    sensitive=false
}
\lstset{
    backgroundcolor=\color{gray!10},
    basicstyle=\footnotesize\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    commentstyle=\color{green!40!black}\slshape,
    deletekeywords={...},
    % (Removed escapeinside and extendedchars to prevent macro parsing issues)
    frame=leftline,
    framerule=4pt,
    keepspaces=true,
    keywordstyle=\color{blue}\bfseries,
    language=bash,
    morekeywords={*,...},
    numbers=left,
    numbersep=8pt,
    numberstyle=\tiny\color{gray},
    rulecolor=\color{blue!80!black},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stepnumber=1,
    stringstyle=\color{orange},
    tabsize=2,
    title=\lstname,
    xleftmargin=15pt,
    framexleftmargin=15pt
}

% Styles spécialisés pour différents langages
\lstdefinestyle{xmlstyle}{
    language=XML,
    backgroundcolor=\color{blue!10},
    keywordstyle=\color{purple}\bfseries,
    commentstyle=\color{green!50!black}\slshape,
    stringstyle=\color{red!70!black},
    frame=leftline,
    framerule=3pt,
    rulecolor=\color{purple!80!black}
}

\lstdefinestyle{pythonstyle}{
    language=Python,
    backgroundcolor=\color{blue!5},
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{green!50!black}\slshape,
    stringstyle=\color{red!70!black},
    frame=leftline,
    framerule=3pt,
    rulecolor=\color{blue!80!black}
}

\lstdefinestyle{bashstyle}{
    language=bash,
    backgroundcolor=\color{black!5},
    keywordstyle=\color{green!50!black}\bfseries,
    commentstyle=\color{gray}\slshape,
    stringstyle=\color{red!70!black},
    frame=leftline,
    framerule=3pt,
    rulecolor=\color{green!80!black}
}

\lstdefinestyle{jsonstyle}{
    language=json,
    backgroundcolor=\color{orange!5},
    keywordstyle=\color{orange}\bfseries,
    commentstyle=\color{green!50!black}\slshape,
    stringstyle=\color{blue!70!black},
    frame=leftline,
    framerule=3pt,
    rulecolor=\color{orange!80!black}
}

\lstdefinestyle{jsstyle}{
    language=JavaScript,
    backgroundcolor=\color{yellow!10},
    keywordstyle=\color{purple}\bfseries,
    commentstyle=\color{green!50!black}\slshape,
    stringstyle=\color{red!70!black},
    frame=leftline,
    framerule=3pt,
    rulecolor=\color{purple!80!black}
}

\lstdefinestyle{yamlstyle}{
    language=yaml,
    backgroundcolor=\color{gray!5},
    keywordstyle=\color{blue!70!black}\bfseries,
    commentstyle=\color{green!50!black}\slshape,
    stringstyle=\color{orange!70!black},
    frame=leftline,
    framerule=3pt,
    rulecolor=\color{blue!40!black}
}

% ===== COULEURS PERSONNALISÉES =====
\definecolor{soarblue}{RGB}{51,102,153}
\definecolor{soargreen}{RGB}{102,153,51}
\definecolor{soarred}{RGB}{153,51,51}
\definecolor{greenOil}{RGB}{197,219,151}

% ===== HYPERLIENS =====
\hypersetup{
    colorlinks=true,
    linkcolor=soarblue,
    urlcolor=soarblue,
    citecolor=soargreen,
    pdfauthor={Med10S},
    pdftitle={Rapport de Stage PFA - Système SIEM/SOAR pour SOC Hospitalier},
    pdfsubject={Cybersécurité - SOC - SIEM/SOAR},
    pdfkeywords={SIEM, SOAR, Cybersécurité, Hôpital, SOC, TheHive, Wazuh}
}

% ===== BIBLIOGRAPHIE =====
\addbibresource{bibliography.bib}

% ===== INFORMATIONS DU DOCUMENT =====
\title{%
    \textbf{Conception et Implémentation d'un Système SIEM/SOAR} \\
    \vspace{0.5cm}
    \large{pour Centre d'Opérations de Sécurité Hospitalière} \\
    \vspace{1cm}
    \normalsize{Rapport de Projet de Fin d'Année (PFA)}
}

\author{%
    \textbf{Med10S} \\
    \vspace{0.3cm}
    \small{Étudiant en Génie des Télécommunications et Réseaux (GTR)} \\
    \small{Semestre 4 - Année Universitaire 2024-2025}
}

\date{Juillet 2025}

% ===== DÉBUT DU DOCUMENT =====
\begin{document}

% ===== PAGE DE TITRE =====
\begin{titlepage}
    \newgeometry{top=1cm, left=0cm, right=0cm, bottom=0cm}
    \centering

    % Banner universitaire en haut au centre
    \begin{minipage}{\textwidth}
        \centering

        % Image du banner universitaire
        \includegraphics[]{images/USMBA_banner.jpg}


        % Ligne de séparation
    \end{minipage}

    \vspace{4cm}    % Titre principal
    {\Huge\bfseries Stage d’Application\par}
    \vspace{0.5cm}
    {\large\bfseries Élève Ingénieur en 2ème année\par}
    \vspace{0.3cm}
    {\large Génie Télécommunications et réseaux\par}
    {\large Stage réalisé au sein du Centre Hospitalière Universitaire de Fes (CHU Fes)\par}

    \vspace{1.5cm}

    % Titre du projet dans un encadré vert
    \fcolorbox{black}{greenOil!30}{%
        \begin{minipage}{0.8\textwidth}
            \centering
            \vspace{0.3cm}
            {\Large\bfseries Conception et Implémentation d'une Solution SIEM/SOAR pour Centre d'Opérations de Sécurité Hospitalière}
            \vspace{0.3cm}
        \end{minipage}
    }



    % Année universitaire
    \vfill
    {\large Période de stage 1/07/2024 au 31/8/2024\par}
    % Section verte avec les informations des personnes
    \fcolorbox{black}{greenOil!40}{%
        \begin{minipage}{\textwidth}
            \vspace{0.3cm}
            \raggedright
            \hspace{3.5cm}\textbf{Réalisé par :} \textbf{M. SBIHI MOHAMMED}\\
            \vspace{2cm}
            \hspace{3.5cm}\textbf{Encadrant ENSAF} \textbf{--------}\\
            \vspace{0.2cm}
            \hspace{3.5cm}\textbf{Encadrant Société } \textbf{--------}\\
            \vspace{1cm}
            \hspace{3.5cm}\textbf{Membres de jury :}\\
            \hspace{4cm}\textbf{Pr. --------}\\
            \hspace{4cm}\textbf{Pr. --------}\\
            \vspace{2cm}
        \end{minipage}
    }


    % Bannière inférieure avec logos


\end{titlepage}
\restoregeometry

% ===== NUMÉROTATION ARABE POUR TOUT LE DOCUMENT =====
\pagenumbering{arabic}
\setcounter{page}{1}

% ===== REMERCIEMENTS =====
\input{sections/remerciements}

% ===== RÉSUMÉ =====
\input{sections/resume}

% ===== ABSTRACT =====
\input{sections/abstract}

% ===== LISTE DES ABRÉVIATIONS =====
\input{sections/abreviations}

% ===== TABLE DES MATIÈRES =====
\clearpage
\setcounter{tocdepth}{2} % include subsections/subsubsections if needed
\setcounter{secnumdepth}{3}
\phantomsection
\tableofcontents
\clearpage

% ===== LISTE DES FIGURES =====
\phantomsection
\listoffigures
\clearpage

% ===== LISTE DES TABLEAUX =====
\phantomsection
\listoftables
\clearpage

\input{sections/introduction}

% ===== STRUCTURE DU PROJET =====
\input{sections/structure_projet}
% ===== CHAPITRES PRINCIPAUX =====
\input{sections/chapitre1_contexte}
\input{sections/chapitre2_methodologie}
\input{sections/chapitre3_implementation}
\input{sections/chapitre4_tests}

% ===== INTRODUCTION GÉNÉRALE =====


% ===== CONCLUSION GÉNÉRALE =====
\input{sections/conclusion}

% ===== PERSPECTIVES FUTURES =====
\input{sections/perspectives}

% ===== BIBLIOGRAPHIE =====
\printbibliography[title=Références Bibliographiques]


% ===== GLOSSAIRE =====
\input{sections/glossaire}

\end{document}
