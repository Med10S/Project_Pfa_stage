<VirtualHost *:80>
    ServerAdmin Med10S@localhost
    DocumentRoot /var/www/html
    
    # Configuration ModSecurity
    SecRuleEngine On
    SecRequestBodyAccess On
    SecResponseBodyAccess On
    
    # Inclusion des règles OWASP CRS et personnalisées
    Include /etc/modsecurity.d/*.conf
    
    # Proxy vers l'application backend
    ProxyPreserveHost On
    ProxyPass / http://webapp:80/
    ProxyPassReverse / http://webapp:80/
    
    # Logs personnalisés pour Wazuh
    ErrorLog /var/log/apache2/modsecurity_error.log
    CustomLog /var/log/apache2/modsecurity_access.log combined
    
    # Log ModSecurity optimisé pour Wazuh
    SecAuditEngine On
    SecAuditLogType Serial
    SecAuditLog /var/log/apache2/modsec_audit.log
    SecAuditLogFormat JSON
    SecAuditLogParts ABCDEFGHIJKZ
    
    # Configuration pour webhook temps réel
    SecAction "id:1000,phase:1,nolog,pass,setenv:WEBHOOK_URL=http://webhook-forwarder:3000/xss-alert"
</VirtualHost>