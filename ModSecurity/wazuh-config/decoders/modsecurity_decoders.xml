<!--
  -  ModSecurity decoders for Wazuh SIEM  
  -  Created by: Med10S
  -  Date: August 11, 2025
  -  Purpose: Parse ModSecurity JSON audit logs and custom alert formats
  -->

<group name="modsecurity,web,">
  <!-- JSON decoder for ModSecurity audit logs -->
  <decoder name="modsecurity-json">
    <parent>json</parent>
    <use_own_name>true</use_own_name>
  </decoder>

  <!-- Custom alert log decoder -->
  <decoder name="modsecurity-custom">
    <parent>syslog</parent>
    <program_name>^modsecurity-waf$</program_name>
    <regex>XSS_ALERT: severity="(\w+)" client_ip="([^"]+)" host="([^"]+)" rule_id="([^"]+)" xss_type="([^"]+)" attack_vector="([^"]+)" payload_size=(\d+) http_code="([^"]+)" mitigation="([^"]+)" unique_id="([^"]+)" user_agent="([^"]+)" analyst="([^"]+)"</regex>
    <order>severity,srcip,host,rule_id,xss_type,attack_vector,payload_size,status,mitigation,unique_id,user_agent,analyst</order>
  </decoder>

  <!-- Decoder for attack payload extraction -->
  <decoder name="modsecurity-payload">
    <parent>modsecurity-json</parent>
    <regex>\"data\":\"Matched Data: ([^\"]+) found within ([^\"]+)\"</regex>
    <order>attack_payload,parameter_name</order>
  </decoder>
</group>
